
-- Drop table

-- DROP TABLE "MI182_rsmartinez".accounts;

CREATE TABLE "MI182_rsmartinez".accounts (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(100) NOT NULL,
	balance numeric(15,2) NOT NULL,
	CONSTRAINT accounts_pkey PRIMARY KEY (id)
);

CREATE OR REPLACE PROCEDURE "MI182_rsmartinez".transfer(INT, INT, DEC)
LANGUAGE plpgsql    
AS $$
BEGIN
    -- subtracting the amount from the sender's account 
    UPDATE "MI182_rsmartinez".accounts 
    SET balance = balance - $3
    WHERE id = $1;
 
    -- adding the amount to the receiver's account
    UPDATE "MI182_rsmartinez".accounts 
    SET balance = balance + $3
    WHERE id = $2;
 
    COMMIT;
END;
$$;

	
CALL "MI182_rsmartinez".transfer(1,2,1000);

SELECT * FROM "MI182_rsmartinez".accounts;
